<div data-article-form-target="optionFields" 
  class="hidden px-4 py-5 bg-white dark:bg-zinc-900 space-y-6 sm:p-6">
  <div class="sm:pb-6 sm:border-b">
    <%= form.select :tag_names, 
      form.object.tag_names.presence || Tag.all.first(10).pluck(:name), 
      {}, 
      multiple: true,
      placeholder: t("articles.add_some_tags"),
      data: {
        controller: "tags-select",
        tags_select_items_value: form.object.tag_names,
        action: "change->article-form#submit"
      }, 
      class: "focus:ring-blue-500 focus:border-blue-500 flex-1 block w-full rounded sm:text-sm border-zinc-300 dark:bg-zinc-900" 
    %>
  </div>

  <div class="sm:pb-6 sm:border-b grid grid-cols-3 gap-3">
    <%= form.label :intro, class: "col-span-3 sm:col-span-1 block text-sm font-medium opacity-70" %>
    <div class="col-span-3 sm:col-span-2">
      <div class="rounded-md shadow-sm">
        <%= form.text_area :intro, 
          value: form.object.intro, 
          rows: 3, 
          data: {
            action: "change->article-form#submit"
          },
          class: "focus:ring-blue-500 focus:border-blue-500 flex-1 block w-full rounded sm:text-sm border-zinc-300 dark:bg-zinc-900" %>
      </div>
      <% if form.object.errors.where(:intro).present? %>
        <div class="py-2 text-red-700 font-sm"><%= form.object.errors.where(:intro).map(&:full_message).join(';') %></div>
      <% end %>
    </div>
  </div>

  <div class="sm:pb-6 sm:border-b grid grid-cols-3 gap-3">
    <%= form.label :currency, required: true, class: "col-span-3 sm:col-span-1 block text-sm font-medium opacity-70" %>
    <div class="col-span-3 sm:col-span-2">
      <div class="hidden">
        <%= form.collection_select :asset_id, 
          Currency.pricable, 
          :asset_id, 
          :symbol, 
          {
            data: {
              action: "change->article-form#submit"
            },
          }, 
          disabled: form.object.published_at?,
          class: "focus:ring-blue-500 focus:border-blue-500 flex-1 block w-full rounded sm:text-sm border-zinc-300 dark:bg-zinc-900" %>
      </div>

      <% if form.object.currency.present? %>
        <%= link_to view_modals_path(type: :pricable_currencies, identifier: form.object.uuid), 
          data: { turbo_method: :post },
          class: "block w-full mb-4 flex items-center justify-between py-2 px-4 bg-zinc-100 dark:bg-zinc-800 rounded-lg" do %>
          <div id="<%= dom_id form.object.currency %>" class="flex items-center space-x-4">
            <div class='relative'>
              <%= image_tag form.object.currency.icon_url, 
                data: { article_form_target: 'currencyIcon' }, 
                class: 'w-8 h-8 rounded-full' %>
              <%= image_tag form.object.currency.icon_url, 
                data: { article_form_target: 'currencyChainIcon' }, 
                class: 'absolute bottom-0 w-3 h-3 rounded-full' %>
            </div>
            <div class="text-lg" data-article-form-target="currencySymbol">
              <%= form.object.currency.symbol %>
            </div>
          </div>
          <%= render 'shared/icons/chevron_right', html_class: 'w-6 h-6 font-bold' %>
        <% end %>
      <% end %>

      <% if form.object.errors.where(:asset_id).present? %>
        <div class="py-2 text-red-700 font-sm"><%= form.object.errors.where(:asset_id).map(&:full_message).join(';') %></div>
      <% end %>
    </div>
  </div>

  <div class="sm:pb-6 sm:border-b grid grid-cols-3 gap-3">
    <%= form.label :price, required: true, class: "col-span-3 sm:col-span-1 block text-sm font-medium opacity-70" %>
    <div class="col-span-3 sm:col-span-2">
      <div class="rounded-md shadow-sm">
        <%= form.number_field :price, 
          required: true, 
          step: '0.0000001', 
          min: '0', 
          data: {
            action: "change->article-form#submit"
          },
          class: "focus:ring-blue-500 focus:border-blue-500 flex-1 block w-full rounded sm:text-sm border-zinc-300 dark:bg-zinc-900", placeholder: "Input price" %>
      </div>
      <% if form.object.currency.present? %>
        <div class="py-2 font-sm opacity-70 text-right">
          â‰ˆ $<%= (form.object.price * form.object.currency.price_usd).floor(2) %>
        </div>
      <% end %>
      <% if form.object.errors.where(:price).present? %>
        <div class="py-2 text-red-700 font-sm"><%= form.object.errors.where(:price).map(&:full_message).join(';') %></div>
      <% end %>
    </div>
  </div>

  <div class="sm:pb-6 sm:border-b grid grid-cols-3 gap-3">
    <%= form.label :readers_revenue_ratio, class: "col-span-3 sm:col-span-1 block text-sm font-medium opacity-70" %>
    <div class="col-span-3 sm:col-span-2">
      <div class="rounded-md shadow-sm">
        <%= form.number_field :readers_revenue_ratio, 
          required: true, 
          disabled: true, 
          class: "flex-1 block w-full rounded sm:text-sm border-zinc-300 bg-zinc-200 dark:bg-zinc-800"
        %>
      </div>
    </div>
  </div>

  <div class="sm:pb-6 sm:border-b grid grid-cols-3 gap-3">
    <%= form.label :platform_revenue_ratio, class: "col-span-3 sm:col-span-1 block text-sm font-medium opacity-70" %>
    <div class="col-span-3 sm:col-span-2">
      <div class="rounded-md shadow-sm">
        <%= form.number_field :platform_revenue_ratio, 
          required: true, 
          disabled: true, 
          class: "flex-1 block w-full rounded sm:text-sm border-zinc-300 bg-zinc-200 dark:bg-zinc-800"
        %>
      </div>
    </div>
  </div>

  <div class="sm:pb-6 sm:border-b grid grid-cols-3 gap-3">
    <%= form.label :author_revenue_ratio, class: "col-span-3 sm:col-span-1 block text-sm font-medium opacity-70" %>
    <div class="col-span-3 sm:col-span-2">
      <div class="rounded-md shadow-sm">
        <%= form.number_field :author_revenue_ratio, 
          required: true, 
          disabled: form.object.published_at?,
          min: "0",
          max: "0.5",
          step: "0.01",
          data: { 
            article_form_target: 'authorRevenueRatio'
          }, 
          class: "flex-1 block w-full rounded sm:text-sm border-zinc-300 bg-zinc-200 dark:bg-zinc-800"
        %>
      </div>
      <% if form.object.errors.where(:author_revenue_ratio).present? %>
        <div class="py-2 text-red-700 font-sm"><%= form.object.errors.where(:author_revenue_ratio).map(&:full_message).join(';') %></div>
      <% end %>
    </div>
  </div>

  <div class="sm:pb-6 sm:border-b grid grid-cols-3 gap-3">
    <%= form.label :references_revenue_ratio, class: "col-span-3 sm:col-span-1 block text-sm font-medium opacity-70" %>
    <div class="col-span-3 sm:col-span-2">
      <div class="rounded-md shadow-sm">
        <%= form.number_field :references_revenue_ratio, 
          required: true, 
          disabled: form.object.published_at?,
          min: "0",
          max: "0.5",
          step: "0.01",
          data: { article_form_target: 'referenceRevenueRatio' }, 
          class: "flex-1 block w-full rounded sm:text-sm border-zinc-300 bg-zinc-200 dark:bg-zinc-800"
        %>
      </div>
      <% if form.object.errors.where(:references_revenue_ratio).present? %>
        <div class="py-2 text-red-700 font-sm"><%= form.object.errors.where(:references_revenue_ratio).map(&:full_message).join(';') %></div>
      <% end %>
    </div>
  </div>

  <template class="hidden" data-nested-form-target="template">
    <%= form.fields_for :article_references, form.object.article_references.new, child_index: 'NEW_RECORD', data: { new_record: true } do |reference_form| %>
      <%= render partial:  "article_references/form", locals: { form: reference_form, article: form.object } %>
    <% end %>
  </template>

  <%= form.fields_for :article_references do |reference_form| %>
    <%= render partial:  "article_references/form", locals: { form: reference_form, article: form.object } unless reference_form.object.new_record? %>
  <% end %>
  <% if form.object.published_at.blank? %>
    <div data-nested-form-target="target"></div>
    <div 
      data-action="click->nested-form#add click->article-form#calReferenceRatio"
      class="cursor-pointer w-full block px-4 py-1 text-center border border-blue-500 text-blue-500">
      <%= t('articles.add_reference') %>
    </div>
  <% end %>
</div>
